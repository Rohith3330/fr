{"ast":null,"code":"'use strict';\n\nvar transport = require('../../../spdy-transport');\n\nvar base = transport.protocol.base;\n\nvar constants = require('./').constants;\n\nvar assert = require('assert');\n\nvar util = require('util');\n\nvar WriteBuffer = require('wbuf');\n\nvar OffsetBuffer = require('obuf');\n\nvar debug = require('debug')('spdy:framer');\n\nvar debugExtra = require('debug')('spdy:framer:extra');\n\nfunction Framer(options) {\n  base.Framer.call(this, options);\n  this.maxFrameSize = constants.INITIAL_MAX_FRAME_SIZE;\n}\n\nutil.inherits(Framer, base.Framer);\nmodule.exports = Framer;\n\nFramer.create = function create(options) {\n  return new Framer(options);\n};\n\nFramer.prototype.setMaxFrameSize = function setMaxFrameSize(size) {\n  this.maxFrameSize = size;\n};\n\nFramer.prototype._frame = function _frame(frame, body, callback) {\n  debug('id=%d type=%s', frame.id, frame.type);\n  var buffer = new WriteBuffer();\n  buffer.reserve(constants.FRAME_HEADER_SIZE);\n  var len = buffer.skip(3);\n  buffer.writeUInt8(constants.frameType[frame.type]);\n  buffer.writeUInt8(frame.flags);\n  buffer.writeUInt32BE(frame.id & 0x7fffffff);\n  body(buffer);\n  var frameSize = buffer.size - constants.FRAME_HEADER_SIZE;\n  len.writeUInt24BE(frameSize);\n  var chunks = buffer.render();\n  var toWrite = {\n    stream: frame.id,\n    priority: frame.priority === undefined ? false : frame.priority,\n    chunks: chunks,\n    callback: callback\n  };\n\n  if (this.window && frame.type === 'DATA') {\n    var self = this;\n\n    this._resetTimeout();\n\n    this.window.send.update(-frameSize, function () {\n      self._resetTimeout();\n\n      self.schedule(toWrite);\n    });\n  } else {\n    this._resetTimeout();\n\n    this.schedule(toWrite);\n  }\n\n  return chunks;\n};\n\nFramer.prototype._split = function _split(frame) {\n  var buf = new OffsetBuffer();\n\n  for (var i = 0; i < frame.chunks.length; i++) {\n    buf.push(frame.chunks[i]);\n  }\n\n  var frames = [];\n\n  while (!buf.isEmpty()) {\n    // First frame may have reserved bytes in it\n    var size = this.maxFrameSize;\n\n    if (frames.length === 0) {\n      size -= frame.reserve;\n    }\n\n    size = Math.min(size, buf.size);\n    var frameBuf = buf.clone(size);\n    buf.skip(size);\n    frames.push({\n      size: frameBuf.size,\n      chunks: frameBuf.toChunks()\n    });\n  }\n\n  return frames;\n};\n\nFramer.prototype._continuationFrame = function _continuationFrame(frame, body, callback) {\n  var frames = this._split(frame);\n\n  frames.forEach(function (subFrame, i) {\n    var isFirst = i === 0;\n    var isLast = i === frames.length - 1;\n    var flags = isLast ? constants.flags.END_HEADERS : 0; // PRIORITY and friends\n\n    if (isFirst) {\n      flags |= frame.flags;\n    }\n\n    this._frame({\n      id: frame.id,\n      priority: false,\n      type: isFirst ? frame.type : 'CONTINUATION',\n      flags: flags\n    }, function (buf) {\n      // Fill those reserved bytes\n      if (isFirst && body) {\n        body(buf);\n      }\n\n      buf.reserve(subFrame.size);\n\n      for (var i = 0; i < subFrame.chunks.length; i++) {\n        buf.copyFrom(subFrame.chunks[i]);\n      }\n    }, isLast ? callback : null);\n  }, this);\n\n  if (frames.length === 0) {\n    this._frame({\n      id: frame.id,\n      priority: false,\n      type: frame.type,\n      flags: frame.flags | constants.flags.END_HEADERS\n    }, function (buf) {\n      if (body) {\n        body(buf);\n      }\n    }, callback);\n  }\n};\n\nFramer.prototype._compressHeaders = function _compressHeaders(headers, pairs, callback) {\n  Object.keys(headers || {}).forEach(function (name) {\n    var lowName = name.toLowerCase(); // Not allowed in HTTP2\n\n    switch (lowName) {\n      case 'host':\n      case 'connection':\n      case 'keep-alive':\n      case 'proxy-connection':\n      case 'transfer-encoding':\n      case 'upgrade':\n        return;\n    } // Should be in `pairs`\n\n\n    if (/^:/.test(lowName)) {\n      return;\n    } // Do not compress, or index Cookie field (for security reasons)\n\n\n    var neverIndex = lowName === 'cookie' || lowName === 'set-cookie';\n    var value = headers[name];\n\n    if (Array.isArray(value)) {\n      for (var i = 0; i < value.length; i++) {\n        pairs.push({\n          name: lowName,\n          value: value[i] + '',\n          neverIndex: neverIndex,\n          huffman: !neverIndex\n        });\n      }\n    } else {\n      pairs.push({\n        name: lowName,\n        value: value + '',\n        neverIndex: neverIndex,\n        huffman: !neverIndex\n      });\n    }\n  });\n  assert(this.compress !== null, 'Framer version not initialized');\n  debugExtra('compressing headers=%j', pairs);\n  this.compress.write([pairs], callback);\n};\n\nFramer.prototype._isDefaultPriority = function _isDefaultPriority(priority) {\n  if (!priority) {\n    return true;\n  }\n\n  return !priority.parent && priority.weight === constants.DEFAULT && !priority.exclusive;\n};\n\nFramer.prototype._defaultHeaders = function _defaultHeaders(frame, pairs) {\n  if (!frame.path) {\n    throw new Error('`path` is required frame argument');\n  }\n\n  pairs.push({\n    name: ':method',\n    value: frame.method || base.constants.DEFAULT_METHOD\n  });\n  pairs.push({\n    name: ':path',\n    value: frame.path\n  });\n  pairs.push({\n    name: ':scheme',\n    value: frame.scheme || 'https'\n  });\n  pairs.push({\n    name: ':authority',\n    value: frame.host || frame.headers && frame.headers.host || base.constants.DEFAULT_HOST\n  });\n};\n\nFramer.prototype._headersFrame = function _headersFrame(kind, frame, callback) {\n  var pairs = [];\n\n  if (kind === 'request') {\n    this._defaultHeaders(frame, pairs);\n  } else if (kind === 'response') {\n    pairs.push({\n      name: ':status',\n      value: (frame.status || 200) + ''\n    });\n  }\n\n  var self = this;\n\n  this._compressHeaders(frame.headers, pairs, function (err, chunks) {\n    if (err) {\n      if (callback) {\n        return callback(err);\n      } else {\n        return self.emit('error', err);\n      }\n    }\n\n    var reserve = 0; // If priority info is present, and the values are not default ones\n    // reserve space for the priority info and add PRIORITY flag\n\n    var priority = frame.priority;\n\n    if (!self._isDefaultPriority(priority)) {\n      reserve = 5;\n    }\n\n    var flags = reserve === 0 ? 0 : constants.flags.PRIORITY; // Mostly for testing\n\n    if (frame.fin) {\n      flags |= constants.flags.END_STREAM;\n    }\n\n    self._continuationFrame({\n      id: frame.id,\n      type: 'HEADERS',\n      flags: flags,\n      reserve: reserve,\n      chunks: chunks\n    }, function (buf) {\n      if (reserve === 0) {\n        return;\n      }\n\n      buf.writeUInt32BE(((priority.exclusive ? 0x80000000 : 0) | priority.parent) >>> 0);\n      buf.writeUInt8((priority.weight | 0) - 1);\n    }, callback);\n  });\n};\n\nFramer.prototype.requestFrame = function requestFrame(frame, callback) {\n  return this._headersFrame('request', frame, callback);\n};\n\nFramer.prototype.responseFrame = function responseFrame(frame, callback) {\n  return this._headersFrame('response', frame, callback);\n};\n\nFramer.prototype.headersFrame = function headersFrame(frame, callback) {\n  return this._headersFrame('headers', frame, callback);\n};\n\nFramer.prototype.pushFrame = function pushFrame(frame, callback) {\n  var self = this;\n\n  function compress(headers, pairs, callback) {\n    self._compressHeaders(headers, pairs, function (err, chunks) {\n      if (err) {\n        if (callback) {\n          return callback(err);\n        } else {\n          return self.emit('error', err);\n        }\n      }\n\n      callback(chunks);\n    });\n  }\n\n  function sendPromise(chunks) {\n    self._continuationFrame({\n      id: frame.id,\n      type: 'PUSH_PROMISE',\n      reserve: 4,\n      chunks: chunks\n    }, function (buf) {\n      buf.writeUInt32BE(frame.promisedId);\n    });\n  }\n\n  function sendResponse(chunks, callback) {\n    var priority = frame.priority;\n\n    var isDefaultPriority = self._isDefaultPriority(priority);\n\n    var flags = isDefaultPriority ? 0 : constants.flags.PRIORITY; // Mostly for testing\n\n    if (frame.fin) {\n      flags |= constants.flags.END_STREAM;\n    }\n\n    self._continuationFrame({\n      id: frame.promisedId,\n      type: 'HEADERS',\n      flags: flags,\n      reserve: isDefaultPriority ? 0 : 5,\n      chunks: chunks\n    }, function (buf) {\n      if (isDefaultPriority) {\n        return;\n      }\n\n      buf.writeUInt32BE((priority.exclusive ? 0x80000000 : 0) | priority.parent);\n      buf.writeUInt8((priority.weight | 0) - 1);\n    }, callback);\n  }\n\n  this._checkPush(function (err) {\n    if (err) {\n      return callback(err);\n    }\n\n    var pairs = {\n      promise: [],\n      response: []\n    };\n\n    self._defaultHeaders(frame, pairs.promise);\n\n    pairs.response.push({\n      name: ':status',\n      value: (frame.status || 200) + ''\n    });\n    compress(frame.headers, pairs.promise, function (promiseChunks) {\n      sendPromise(promiseChunks);\n\n      if (frame.response === false) {\n        return callback(null);\n      }\n\n      compress(frame.response, pairs.response, function (responseChunks) {\n        sendResponse(responseChunks, callback);\n      });\n    });\n  });\n};\n\nFramer.prototype.priorityFrame = function priorityFrame(frame, callback) {\n  this._frame({\n    id: frame.id,\n    priority: false,\n    type: 'PRIORITY',\n    flags: 0\n  }, function (buf) {\n    var priority = frame.priority;\n    buf.writeUInt32BE((priority.exclusive ? 0x80000000 : 0) | priority.parent);\n    buf.writeUInt8((priority.weight | 0) - 1);\n  }, callback);\n};\n\nFramer.prototype.dataFrame = function dataFrame(frame, callback) {\n  var frames = this._split({\n    reserve: 0,\n    chunks: [frame.data]\n  });\n\n  var fin = frame.fin ? constants.flags.END_STREAM : 0;\n  var self = this;\n  frames.forEach(function (subFrame, i) {\n    var isLast = i === frames.length - 1;\n    var flags = 0;\n\n    if (isLast) {\n      flags |= fin;\n    }\n\n    self._frame({\n      id: frame.id,\n      priority: frame.priority,\n      type: 'DATA',\n      flags: flags\n    }, function (buf) {\n      buf.reserve(subFrame.size);\n\n      for (var i = 0; i < subFrame.chunks.length; i++) {\n        buf.copyFrom(subFrame.chunks[i]);\n      }\n    }, isLast ? callback : null);\n  }); // Empty DATA\n\n  if (frames.length === 0) {\n    this._frame({\n      id: frame.id,\n      priority: frame.priority,\n      type: 'DATA',\n      flags: fin\n    }, function (buf) {// No-op\n    }, callback);\n  }\n};\n\nFramer.prototype.pingFrame = function pingFrame(frame, callback) {\n  this._frame({\n    id: 0,\n    type: 'PING',\n    flags: frame.ack ? constants.flags.ACK : 0\n  }, function (buf) {\n    buf.copyFrom(frame.opaque);\n  }, callback);\n};\n\nFramer.prototype.rstFrame = function rstFrame(frame, callback) {\n  this._frame({\n    id: frame.id,\n    type: 'RST_STREAM',\n    flags: 0\n  }, function (buf) {\n    buf.writeUInt32BE(constants.error[frame.code]);\n  }, callback);\n};\n\nFramer.prototype.prefaceFrame = function prefaceFrame(callback) {\n  debug('preface');\n\n  this._resetTimeout();\n\n  this.schedule({\n    stream: 0,\n    priority: false,\n    chunks: [constants.PREFACE_BUFFER],\n    callback: callback\n  });\n};\n\nFramer.prototype.settingsFrame = function settingsFrame(options, callback) {\n  var key = JSON.stringify(options);\n  var settings = Framer.settingsCache[key];\n\n  if (settings) {\n    debug('cached settings');\n\n    this._resetTimeout();\n\n    this.schedule({\n      id: 0,\n      priority: false,\n      chunks: settings,\n      callback: callback\n    });\n    return;\n  }\n\n  var params = [];\n\n  for (var i = 0; i < constants.settingsIndex.length; i++) {\n    var name = constants.settingsIndex[i];\n\n    if (!name) {\n      continue;\n    } // value: Infinity\n\n\n    if (!isFinite(options[name])) {\n      continue;\n    }\n\n    if (options[name] !== undefined) {\n      params.push({\n        key: i,\n        value: options[name]\n      });\n    }\n  }\n\n  var bodySize = params.length * 6;\n\n  var chunks = this._frame({\n    id: 0,\n    type: 'SETTINGS',\n    flags: 0\n  }, function (buffer) {\n    buffer.reserve(bodySize);\n\n    for (var i = 0; i < params.length; i++) {\n      var param = params[i];\n      buffer.writeUInt16BE(param.key);\n      buffer.writeUInt32BE(param.value);\n    }\n  }, callback);\n\n  Framer.settingsCache[key] = chunks;\n};\n\nFramer.settingsCache = {};\n\nFramer.prototype.ackSettingsFrame = function ackSettingsFrame(callback) {\n  /* var chunks = */\n  this._frame({\n    id: 0,\n    type: 'SETTINGS',\n    flags: constants.flags.ACK\n  }, function (buffer) {// No-op\n  }, callback);\n};\n\nFramer.prototype.windowUpdateFrame = function windowUpdateFrame(frame, callback) {\n  this._frame({\n    id: frame.id,\n    type: 'WINDOW_UPDATE',\n    flags: 0\n  }, function (buffer) {\n    buffer.reserve(4);\n    buffer.writeInt32BE(frame.delta);\n  }, callback);\n};\n\nFramer.prototype.goawayFrame = function goawayFrame(frame, callback) {\n  this._frame({\n    type: 'GOAWAY',\n    id: 0,\n    flags: 0\n  }, function (buf) {\n    buf.reserve(8); // Last-good-stream-ID\n\n    buf.writeUInt32BE(frame.lastId & 0x7fffffff); // Code\n\n    buf.writeUInt32BE(constants.goaway[frame.code]); // Extra debugging information\n\n    if (frame.extra) {\n      buf.write(frame.extra);\n    }\n  }, callback);\n};\n\nFramer.prototype.xForwardedFor = function xForwardedFor(frame, callback) {\n  this._frame({\n    type: 'X_FORWARDED_FOR',\n    id: 0,\n    flags: 0\n  }, function (buf) {\n    buf.write(frame.host);\n  }, callback);\n};","map":{"version":3,"names":["transport","require","base","protocol","constants","assert","util","WriteBuffer","OffsetBuffer","debug","debugExtra","Framer","options","call","maxFrameSize","INITIAL_MAX_FRAME_SIZE","inherits","module","exports","create","prototype","setMaxFrameSize","size","_frame","frame","body","callback","id","type","buffer","reserve","FRAME_HEADER_SIZE","len","skip","writeUInt8","frameType","flags","writeUInt32BE","frameSize","writeUInt24BE","chunks","render","toWrite","stream","priority","undefined","window","self","_resetTimeout","send","update","schedule","_split","buf","i","length","push","frames","isEmpty","Math","min","frameBuf","clone","toChunks","_continuationFrame","forEach","subFrame","isFirst","isLast","END_HEADERS","copyFrom","_compressHeaders","headers","pairs","Object","keys","name","lowName","toLowerCase","test","neverIndex","value","Array","isArray","huffman","compress","write","_isDefaultPriority","parent","weight","DEFAULT","exclusive","_defaultHeaders","path","Error","method","DEFAULT_METHOD","scheme","host","DEFAULT_HOST","_headersFrame","kind","status","err","emit","PRIORITY","fin","END_STREAM","requestFrame","responseFrame","headersFrame","pushFrame","sendPromise","promisedId","sendResponse","isDefaultPriority","_checkPush","promise","response","promiseChunks","responseChunks","priorityFrame","dataFrame","data","pingFrame","ack","ACK","opaque","rstFrame","error","code","prefaceFrame","PREFACE_BUFFER","settingsFrame","key","JSON","stringify","settings","settingsCache","params","settingsIndex","isFinite","bodySize","param","writeUInt16BE","ackSettingsFrame","windowUpdateFrame","writeInt32BE","delta","goawayFrame","lastId","goaway","extra","xForwardedFor"],"sources":["C:/Users/Rohith/mern/frontend/node_modules/spdy-transport/lib/spdy-transport/protocol/http2/framer.js"],"sourcesContent":["'use strict'\n\nvar transport = require('../../../spdy-transport')\nvar base = transport.protocol.base\nvar constants = require('./').constants\n\nvar assert = require('assert')\nvar util = require('util')\nvar WriteBuffer = require('wbuf')\nvar OffsetBuffer = require('obuf')\nvar debug = require('debug')('spdy:framer')\nvar debugExtra = require('debug')('spdy:framer:extra')\n\nfunction Framer (options) {\n  base.Framer.call(this, options)\n\n  this.maxFrameSize = constants.INITIAL_MAX_FRAME_SIZE\n}\nutil.inherits(Framer, base.Framer)\nmodule.exports = Framer\n\nFramer.create = function create (options) {\n  return new Framer(options)\n}\n\nFramer.prototype.setMaxFrameSize = function setMaxFrameSize (size) {\n  this.maxFrameSize = size\n}\n\nFramer.prototype._frame = function _frame (frame, body, callback) {\n  debug('id=%d type=%s', frame.id, frame.type)\n\n  var buffer = new WriteBuffer()\n\n  buffer.reserve(constants.FRAME_HEADER_SIZE)\n  var len = buffer.skip(3)\n  buffer.writeUInt8(constants.frameType[frame.type])\n  buffer.writeUInt8(frame.flags)\n  buffer.writeUInt32BE(frame.id & 0x7fffffff)\n\n  body(buffer)\n\n  var frameSize = buffer.size - constants.FRAME_HEADER_SIZE\n  len.writeUInt24BE(frameSize)\n\n  var chunks = buffer.render()\n  var toWrite = {\n    stream: frame.id,\n    priority: frame.priority === undefined ? false : frame.priority,\n    chunks: chunks,\n    callback: callback\n  }\n\n  if (this.window && frame.type === 'DATA') {\n    var self = this\n    this._resetTimeout()\n    this.window.send.update(-frameSize, function () {\n      self._resetTimeout()\n      self.schedule(toWrite)\n    })\n  } else {\n    this._resetTimeout()\n    this.schedule(toWrite)\n  }\n\n  return chunks\n}\n\nFramer.prototype._split = function _split (frame) {\n  var buf = new OffsetBuffer()\n  for (var i = 0; i < frame.chunks.length; i++) { buf.push(frame.chunks[i]) }\n\n  var frames = []\n  while (!buf.isEmpty()) {\n    // First frame may have reserved bytes in it\n    var size = this.maxFrameSize\n    if (frames.length === 0) {\n      size -= frame.reserve\n    }\n    size = Math.min(size, buf.size)\n\n    var frameBuf = buf.clone(size)\n    buf.skip(size)\n\n    frames.push({\n      size: frameBuf.size,\n      chunks: frameBuf.toChunks()\n    })\n  }\n\n  return frames\n}\n\nFramer.prototype._continuationFrame = function _continuationFrame (frame,\n  body,\n  callback) {\n  var frames = this._split(frame)\n\n  frames.forEach(function (subFrame, i) {\n    var isFirst = i === 0\n    var isLast = i === frames.length - 1\n\n    var flags = isLast ? constants.flags.END_HEADERS : 0\n\n    // PRIORITY and friends\n    if (isFirst) {\n      flags |= frame.flags\n    }\n\n    this._frame({\n      id: frame.id,\n      priority: false,\n      type: isFirst ? frame.type : 'CONTINUATION',\n      flags: flags\n    }, function (buf) {\n      // Fill those reserved bytes\n      if (isFirst && body) { body(buf) }\n\n      buf.reserve(subFrame.size)\n      for (var i = 0; i < subFrame.chunks.length; i++) { buf.copyFrom(subFrame.chunks[i]) }\n    }, isLast ? callback : null)\n  }, this)\n\n  if (frames.length === 0) {\n    this._frame({\n      id: frame.id,\n      priority: false,\n      type: frame.type,\n      flags: frame.flags | constants.flags.END_HEADERS\n    }, function (buf) {\n      if (body) { body(buf) }\n    }, callback)\n  }\n}\n\nFramer.prototype._compressHeaders = function _compressHeaders (headers,\n  pairs,\n  callback) {\n  Object.keys(headers || {}).forEach(function (name) {\n    var lowName = name.toLowerCase()\n\n    // Not allowed in HTTP2\n    switch (lowName) {\n      case 'host':\n      case 'connection':\n      case 'keep-alive':\n      case 'proxy-connection':\n      case 'transfer-encoding':\n      case 'upgrade':\n        return\n    }\n\n    // Should be in `pairs`\n    if (/^:/.test(lowName)) {\n      return\n    }\n\n    // Do not compress, or index Cookie field (for security reasons)\n    var neverIndex = lowName === 'cookie' || lowName === 'set-cookie'\n\n    var value = headers[name]\n    if (Array.isArray(value)) {\n      for (var i = 0; i < value.length; i++) {\n        pairs.push({\n          name: lowName,\n          value: value[i] + '',\n          neverIndex: neverIndex,\n          huffman: !neverIndex\n        })\n      }\n    } else {\n      pairs.push({\n        name: lowName,\n        value: value + '',\n        neverIndex: neverIndex,\n        huffman: !neverIndex\n      })\n    }\n  })\n\n  assert(this.compress !== null, 'Framer version not initialized')\n  debugExtra('compressing headers=%j', pairs)\n  this.compress.write([ pairs ], callback)\n}\n\nFramer.prototype._isDefaultPriority = function _isDefaultPriority (priority) {\n  if (!priority) { return true }\n\n  return !priority.parent &&\n         priority.weight === constants.DEFAULT &&\n         !priority.exclusive\n}\n\nFramer.prototype._defaultHeaders = function _defaultHeaders (frame, pairs) {\n  if (!frame.path) {\n    throw new Error('`path` is required frame argument')\n  }\n\n  pairs.push({\n    name: ':method',\n    value: frame.method || base.constants.DEFAULT_METHOD\n  })\n  pairs.push({ name: ':path', value: frame.path })\n  pairs.push({ name: ':scheme', value: frame.scheme || 'https' })\n  pairs.push({\n    name: ':authority',\n    value: frame.host ||\n           (frame.headers && frame.headers.host) ||\n           base.constants.DEFAULT_HOST\n  })\n}\n\nFramer.prototype._headersFrame = function _headersFrame (kind, frame, callback) {\n  var pairs = []\n\n  if (kind === 'request') {\n    this._defaultHeaders(frame, pairs)\n  } else if (kind === 'response') {\n    pairs.push({ name: ':status', value: (frame.status || 200) + '' })\n  }\n\n  var self = this\n  this._compressHeaders(frame.headers, pairs, function (err, chunks) {\n    if (err) {\n      if (callback) {\n        return callback(err)\n      } else {\n        return self.emit('error', err)\n      }\n    }\n\n    var reserve = 0\n\n    // If priority info is present, and the values are not default ones\n    // reserve space for the priority info and add PRIORITY flag\n    var priority = frame.priority\n    if (!self._isDefaultPriority(priority)) { reserve = 5 }\n\n    var flags = reserve === 0 ? 0 : constants.flags.PRIORITY\n\n    // Mostly for testing\n    if (frame.fin) {\n      flags |= constants.flags.END_STREAM\n    }\n\n    self._continuationFrame({\n      id: frame.id,\n      type: 'HEADERS',\n      flags: flags,\n      reserve: reserve,\n      chunks: chunks\n    }, function (buf) {\n      if (reserve === 0) {\n        return\n      }\n\n      buf.writeUInt32BE(((priority.exclusive ? 0x80000000 : 0) |\n                         priority.parent) >>> 0)\n      buf.writeUInt8((priority.weight | 0) - 1)\n    }, callback)\n  })\n}\n\nFramer.prototype.requestFrame = function requestFrame (frame, callback) {\n  return this._headersFrame('request', frame, callback)\n}\n\nFramer.prototype.responseFrame = function responseFrame (frame, callback) {\n  return this._headersFrame('response', frame, callback)\n}\n\nFramer.prototype.headersFrame = function headersFrame (frame, callback) {\n  return this._headersFrame('headers', frame, callback)\n}\n\nFramer.prototype.pushFrame = function pushFrame (frame, callback) {\n  var self = this\n\n  function compress (headers, pairs, callback) {\n    self._compressHeaders(headers, pairs, function (err, chunks) {\n      if (err) {\n        if (callback) {\n          return callback(err)\n        } else {\n          return self.emit('error', err)\n        }\n      }\n\n      callback(chunks)\n    })\n  }\n\n  function sendPromise (chunks) {\n    self._continuationFrame({\n      id: frame.id,\n      type: 'PUSH_PROMISE',\n      reserve: 4,\n      chunks: chunks\n    }, function (buf) {\n      buf.writeUInt32BE(frame.promisedId)\n    })\n  }\n\n  function sendResponse (chunks, callback) {\n    var priority = frame.priority\n    var isDefaultPriority = self._isDefaultPriority(priority)\n    var flags = isDefaultPriority ? 0 : constants.flags.PRIORITY\n\n    // Mostly for testing\n    if (frame.fin) {\n      flags |= constants.flags.END_STREAM\n    }\n\n    self._continuationFrame({\n      id: frame.promisedId,\n      type: 'HEADERS',\n      flags: flags,\n      reserve: isDefaultPriority ? 0 : 5,\n      chunks: chunks\n    }, function (buf) {\n      if (isDefaultPriority) {\n        return\n      }\n\n      buf.writeUInt32BE((priority.exclusive ? 0x80000000 : 0) |\n                        priority.parent)\n      buf.writeUInt8((priority.weight | 0) - 1)\n    }, callback)\n  }\n\n  this._checkPush(function (err) {\n    if (err) {\n      return callback(err)\n    }\n\n    var pairs = {\n      promise: [],\n      response: []\n    }\n\n    self._defaultHeaders(frame, pairs.promise)\n    pairs.response.push({ name: ':status', value: (frame.status || 200) + '' })\n\n    compress(frame.headers, pairs.promise, function (promiseChunks) {\n      sendPromise(promiseChunks)\n      if (frame.response === false) {\n        return callback(null)\n      }\n      compress(frame.response, pairs.response, function (responseChunks) {\n        sendResponse(responseChunks, callback)\n      })\n    })\n  })\n}\n\nFramer.prototype.priorityFrame = function priorityFrame (frame, callback) {\n  this._frame({\n    id: frame.id,\n    priority: false,\n    type: 'PRIORITY',\n    flags: 0\n  }, function (buf) {\n    var priority = frame.priority\n    buf.writeUInt32BE((priority.exclusive ? 0x80000000 : 0) |\n                      priority.parent)\n    buf.writeUInt8((priority.weight | 0) - 1)\n  }, callback)\n}\n\nFramer.prototype.dataFrame = function dataFrame (frame, callback) {\n  var frames = this._split({\n    reserve: 0,\n    chunks: [ frame.data ]\n  })\n\n  var fin = frame.fin ? constants.flags.END_STREAM : 0\n\n  var self = this\n  frames.forEach(function (subFrame, i) {\n    var isLast = i === frames.length - 1\n    var flags = 0\n    if (isLast) {\n      flags |= fin\n    }\n\n    self._frame({\n      id: frame.id,\n      priority: frame.priority,\n      type: 'DATA',\n      flags: flags\n    }, function (buf) {\n      buf.reserve(subFrame.size)\n      for (var i = 0; i < subFrame.chunks.length; i++) { buf.copyFrom(subFrame.chunks[i]) }\n    }, isLast ? callback : null)\n  })\n\n  // Empty DATA\n  if (frames.length === 0) {\n    this._frame({\n      id: frame.id,\n      priority: frame.priority,\n      type: 'DATA',\n      flags: fin\n    }, function (buf) {\n      // No-op\n    }, callback)\n  }\n}\n\nFramer.prototype.pingFrame = function pingFrame (frame, callback) {\n  this._frame({\n    id: 0,\n    type: 'PING',\n    flags: frame.ack ? constants.flags.ACK : 0\n  }, function (buf) {\n    buf.copyFrom(frame.opaque)\n  }, callback)\n}\n\nFramer.prototype.rstFrame = function rstFrame (frame, callback) {\n  this._frame({\n    id: frame.id,\n    type: 'RST_STREAM',\n    flags: 0\n  }, function (buf) {\n    buf.writeUInt32BE(constants.error[frame.code])\n  }, callback)\n}\n\nFramer.prototype.prefaceFrame = function prefaceFrame (callback) {\n  debug('preface')\n  this._resetTimeout()\n  this.schedule({\n    stream: 0,\n    priority: false,\n    chunks: [ constants.PREFACE_BUFFER ],\n    callback: callback\n  })\n}\n\nFramer.prototype.settingsFrame = function settingsFrame (options, callback) {\n  var key = JSON.stringify(options)\n\n  var settings = Framer.settingsCache[key]\n  if (settings) {\n    debug('cached settings')\n    this._resetTimeout()\n    this.schedule({\n      id: 0,\n      priority: false,\n      chunks: settings,\n      callback: callback\n    })\n    return\n  }\n\n  var params = []\n  for (var i = 0; i < constants.settingsIndex.length; i++) {\n    var name = constants.settingsIndex[i]\n    if (!name) {\n      continue\n    }\n\n    // value: Infinity\n    if (!isFinite(options[name])) {\n      continue\n    }\n\n    if (options[name] !== undefined) {\n      params.push({ key: i, value: options[name] })\n    }\n  }\n\n  var bodySize = params.length * 6\n\n  var chunks = this._frame({\n    id: 0,\n    type: 'SETTINGS',\n    flags: 0\n  }, function (buffer) {\n    buffer.reserve(bodySize)\n    for (var i = 0; i < params.length; i++) {\n      var param = params[i]\n\n      buffer.writeUInt16BE(param.key)\n      buffer.writeUInt32BE(param.value)\n    }\n  }, callback)\n\n  Framer.settingsCache[key] = chunks\n}\nFramer.settingsCache = {}\n\nFramer.prototype.ackSettingsFrame = function ackSettingsFrame (callback) {\n  /* var chunks = */ this._frame({\n    id: 0,\n    type: 'SETTINGS',\n    flags: constants.flags.ACK\n  }, function (buffer) {\n    // No-op\n  }, callback)\n}\n\nFramer.prototype.windowUpdateFrame = function windowUpdateFrame (frame,\n  callback) {\n  this._frame({\n    id: frame.id,\n    type: 'WINDOW_UPDATE',\n    flags: 0\n  }, function (buffer) {\n    buffer.reserve(4)\n    buffer.writeInt32BE(frame.delta)\n  }, callback)\n}\n\nFramer.prototype.goawayFrame = function goawayFrame (frame, callback) {\n  this._frame({\n    type: 'GOAWAY',\n    id: 0,\n    flags: 0\n  }, function (buf) {\n    buf.reserve(8)\n\n    // Last-good-stream-ID\n    buf.writeUInt32BE(frame.lastId & 0x7fffffff)\n    // Code\n    buf.writeUInt32BE(constants.goaway[frame.code])\n\n    // Extra debugging information\n    if (frame.extra) { buf.write(frame.extra) }\n  }, callback)\n}\n\nFramer.prototype.xForwardedFor = function xForwardedFor (frame, callback) {\n  this._frame({\n    type: 'X_FORWARDED_FOR',\n    id: 0,\n    flags: 0\n  }, function (buf) {\n    buf.write(frame.host)\n  }, callback)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}