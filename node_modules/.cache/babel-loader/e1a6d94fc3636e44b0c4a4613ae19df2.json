{"ast":null,"code":"//compile doT templates to js functions\n'use strict';\n\nvar glob = require('glob'),\n    fs = require('fs'),\n    path = require('path'),\n    doT = require('dot'),\n    beautify = require('js-beautify').js_beautify;\n\nvar defsRootPath = process.argv[2] || path.join(__dirname, '../lib');\nvar defs = {};\nvar defFiles = glob.sync('./dot/**/*.def', {\n  cwd: defsRootPath\n});\ndefFiles.forEach(function (f) {\n  var name = path.basename(f, '.def');\n  defs[name] = fs.readFileSync(path.join(defsRootPath, f));\n});\nvar filesRootPath = process.argv[3] || path.join(__dirname, '../lib');\nvar files = glob.sync('./dot/**/*.jst', {\n  cwd: filesRootPath\n});\nvar dotjsPath = path.join(filesRootPath, './dotjs');\n\ntry {\n  fs.mkdirSync(dotjsPath);\n} catch (e) {}\n\nconsole.log('\\n\\nCompiling:');\nvar FUNCTION_NAME = /function\\s+anonymous\\s*\\(it[^)]*\\)\\s*{/;\nvar OUT_EMPTY_STRING = /out\\s*\\+=\\s*'\\s*';/g;\nvar ISTANBUL = /'(istanbul[^']+)';/g;\nvar ERROR_KEYWORD = /\\$errorKeyword/g;\nvar ERROR_KEYWORD_OR = /\\$errorKeyword\\s+\\|\\|/g;\nvar VARS = ['$errs', '$valid', '$lvl', '$data', '$dataLvl', '$errorKeyword', '$closingBraces', '$schemaPath', '$validate'];\nfiles.forEach(function (f) {\n  var keyword = path.basename(f, '.jst');\n  var targetPath = path.join(dotjsPath, keyword + '.js');\n  var template = fs.readFileSync(path.join(filesRootPath, f));\n  var code = doT.compile(template, defs);\n  code = code.toString().replace(OUT_EMPTY_STRING, '').replace(FUNCTION_NAME, 'function generate_' + keyword + '(it, $keyword, $ruleType) {').replace(ISTANBUL, '/* $1 */');\n  removeAlwaysFalsyInOr();\n  VARS.forEach(removeUnusedVar);\n  code = \"'use strict';\\nmodule.exports = \" + code;\n  code = beautify(code, {\n    indent_size: 2\n  }) + '\\n';\n  fs.writeFileSync(targetPath, code);\n  console.log('compiled', keyword);\n\n  function removeUnusedVar(v) {\n    v = v.replace(/\\$/g, '\\\\$$');\n    var regexp = new RegExp(v + '[^A-Za-z0-9_$]', 'g');\n    var count = occurrences(regexp);\n\n    if (count == 1) {\n      regexp = new RegExp('var\\\\s+' + v + '\\\\s*=[^;]+;|var\\\\s+' + v + ';');\n      code = code.replace(regexp, '');\n    }\n  }\n\n  function removeAlwaysFalsyInOr() {\n    var countUsed = occurrences(ERROR_KEYWORD);\n    var countOr = occurrences(ERROR_KEYWORD_OR);\n    if (countUsed == countOr + 1) code = code.replace(ERROR_KEYWORD_OR, '');\n  }\n\n  function occurrences(regexp) {\n    return (code.match(regexp) || []).length;\n  }\n});","map":{"version":3,"names":["glob","require","fs","path","doT","beautify","js_beautify","defsRootPath","process","argv","join","__dirname","defs","defFiles","sync","cwd","forEach","f","name","basename","readFileSync","filesRootPath","files","dotjsPath","mkdirSync","e","console","log","FUNCTION_NAME","OUT_EMPTY_STRING","ISTANBUL","ERROR_KEYWORD","ERROR_KEYWORD_OR","VARS","keyword","targetPath","template","code","compile","toString","replace","removeAlwaysFalsyInOr","removeUnusedVar","indent_size","writeFileSync","v","regexp","RegExp","count","occurrences","countUsed","countOr","match","length"],"sources":["C:/Users/Rohith/mern/frontend/node_modules/ajv/scripts/compile-dots.js"],"sourcesContent":["//compile doT templates to js functions\n'use strict';\n\nvar glob = require('glob')\n  , fs = require('fs')\n  , path = require('path')\n  , doT = require('dot')\n  , beautify = require('js-beautify').js_beautify;\n\nvar defsRootPath = process.argv[2] || path.join(__dirname, '../lib');\n\nvar defs = {};\nvar defFiles = glob.sync('./dot/**/*.def', { cwd: defsRootPath });\ndefFiles.forEach(function (f) {\n  var name = path.basename(f, '.def');\n  defs[name] = fs.readFileSync(path.join(defsRootPath, f));\n});\n\nvar filesRootPath = process.argv[3] || path.join(__dirname, '../lib');\nvar files = glob.sync('./dot/**/*.jst', { cwd: filesRootPath });\n\nvar dotjsPath = path.join(filesRootPath, './dotjs');\ntry { fs.mkdirSync(dotjsPath); } catch(e) {}\n\nconsole.log('\\n\\nCompiling:');\n\nvar FUNCTION_NAME = /function\\s+anonymous\\s*\\(it[^)]*\\)\\s*{/;\nvar OUT_EMPTY_STRING = /out\\s*\\+=\\s*'\\s*';/g;\nvar ISTANBUL = /'(istanbul[^']+)';/g;\nvar ERROR_KEYWORD = /\\$errorKeyword/g;\nvar ERROR_KEYWORD_OR = /\\$errorKeyword\\s+\\|\\|/g;\nvar VARS = [\n  '$errs', '$valid', '$lvl', '$data', '$dataLvl',\n  '$errorKeyword', '$closingBraces', '$schemaPath',\n  '$validate'\n];\n\nfiles.forEach(function (f) {\n  var keyword = path.basename(f, '.jst');\n  var targetPath = path.join(dotjsPath, keyword + '.js');\n  var template = fs.readFileSync(path.join(filesRootPath, f));\n  var code = doT.compile(template, defs);\n  code = code.toString()\n             .replace(OUT_EMPTY_STRING, '')\n             .replace(FUNCTION_NAME, 'function generate_' + keyword + '(it, $keyword, $ruleType) {')\n             .replace(ISTANBUL, '/* $1 */');\n  removeAlwaysFalsyInOr();\n  VARS.forEach(removeUnusedVar);\n  code = \"'use strict';\\nmodule.exports = \" + code;\n  code = beautify(code, { indent_size: 2 }) + '\\n';\n  fs.writeFileSync(targetPath, code);\n  console.log('compiled', keyword);\n\n  function removeUnusedVar(v) {\n    v = v.replace(/\\$/g, '\\\\$$');\n    var regexp = new RegExp(v + '[^A-Za-z0-9_$]', 'g');\n    var count = occurrences(regexp);\n    if (count == 1) {\n      regexp = new RegExp('var\\\\s+' + v + '\\\\s*=[^;]+;|var\\\\s+' + v + ';');\n      code = code.replace(regexp, '');\n    }\n  }\n\n  function removeAlwaysFalsyInOr() {\n    var countUsed = occurrences(ERROR_KEYWORD);\n    var countOr = occurrences(ERROR_KEYWORD_OR);\n    if (countUsed == countOr + 1) code = code.replace(ERROR_KEYWORD_OR, '');\n  }\n\n  function occurrences(regexp) {\n    return (code.match(regexp) || []).length;\n  }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}