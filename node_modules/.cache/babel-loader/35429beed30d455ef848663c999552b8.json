{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RULE_NAME = void 0;\n\nconst utils_1 = require(\"@typescript-eslint/utils\");\n\nconst create_testing_library_rule_1 = require(\"../create-testing-library-rule\");\n\nconst node_utils_1 = require(\"../node-utils\");\n\nexports.RULE_NAME = 'prefer-screen-queries';\nconst ALLOWED_RENDER_PROPERTIES_FOR_DESTRUCTURING = ['container', 'baseElement'];\n\nfunction usesContainerOrBaseElement(node) {\n  const secondArgument = node.arguments[1];\n  return (0, node_utils_1.isObjectExpression)(secondArgument) && secondArgument.properties.some(property => (0, node_utils_1.isProperty)(property) && utils_1.ASTUtils.isIdentifier(property.key) && ALLOWED_RENDER_PROPERTIES_FOR_DESTRUCTURING.includes(property.key.name));\n}\n\nexports.default = (0, create_testing_library_rule_1.createTestingLibraryRule)({\n  name: exports.RULE_NAME,\n  meta: {\n    type: 'suggestion',\n    docs: {\n      description: 'Suggest using `screen` while querying',\n      recommendedConfig: {\n        dom: 'error',\n        angular: 'error',\n        react: 'error',\n        vue: 'error',\n        marko: 'error'\n      }\n    },\n    messages: {\n      preferScreenQueries: 'Avoid destructuring queries from `render` result, use `screen.{{ name }}` instead'\n    },\n    schema: []\n  },\n  defaultOptions: [],\n\n  create(context, _, helpers) {\n    const renderWrapperNames = [];\n\n    function detectRenderWrapper(node) {\n      const innerFunction = (0, node_utils_1.getInnermostReturningFunction)(context, node);\n\n      if (innerFunction) {\n        renderWrapperNames.push((0, node_utils_1.getFunctionName)(innerFunction));\n      }\n    }\n\n    function isReportableRender(node) {\n      return helpers.isRenderUtil(node) || renderWrapperNames.includes(node.name);\n    }\n\n    function reportInvalidUsage(node) {\n      context.report({\n        node,\n        messageId: 'preferScreenQueries',\n        data: {\n          name: node.name\n        }\n      });\n    }\n\n    function saveSafeDestructuredQueries(node) {\n      if ((0, node_utils_1.isObjectPattern)(node.id)) {\n        for (const property of node.id.properties) {\n          if ((0, node_utils_1.isProperty)(property) && utils_1.ASTUtils.isIdentifier(property.key) && helpers.isBuiltInQuery(property.key)) {\n            safeDestructuredQueries.push(property.key.name);\n          }\n        }\n      }\n    }\n\n    function isIdentifierAllowed(name) {\n      return ['screen', ...withinDeclaredVariables].includes(name);\n    }\n\n    const safeDestructuredQueries = [];\n    const withinDeclaredVariables = [];\n    return {\n      VariableDeclarator(node) {\n        if (!(0, node_utils_1.isCallExpression)(node.init) || !utils_1.ASTUtils.isIdentifier(node.init.callee)) {\n          return;\n        }\n\n        const isComingFromValidRender = isReportableRender(node.init.callee);\n\n        if (!isComingFromValidRender) {\n          saveSafeDestructuredQueries(node);\n        }\n\n        const isWithinFunction = node.init.callee.name === 'within';\n        const usesRenderOptions = isComingFromValidRender && usesContainerOrBaseElement(node.init);\n\n        if (!isWithinFunction && !usesRenderOptions) {\n          return;\n        }\n\n        if ((0, node_utils_1.isObjectPattern)(node.id)) {\n          saveSafeDestructuredQueries(node);\n        } else if (utils_1.ASTUtils.isIdentifier(node.id)) {\n          withinDeclaredVariables.push(node.id.name);\n        }\n      },\n\n      CallExpression(node) {\n        const identifierNode = (0, node_utils_1.getDeepestIdentifierNode)(node);\n\n        if (!identifierNode) {\n          return;\n        }\n\n        if (helpers.isRenderUtil(identifierNode)) {\n          detectRenderWrapper(identifierNode);\n        }\n\n        if (!helpers.isBuiltInQuery(identifierNode)) {\n          return;\n        }\n\n        if (!(0, node_utils_1.isMemberExpression)(identifierNode.parent)) {\n          const isSafeDestructuredQuery = safeDestructuredQueries.some(queryName => queryName === identifierNode.name);\n\n          if (isSafeDestructuredQuery) {\n            return;\n          }\n\n          reportInvalidUsage(identifierNode);\n          return;\n        }\n\n        const memberExpressionNode = identifierNode.parent;\n\n        if ((0, node_utils_1.isCallExpression)(memberExpressionNode.object) && utils_1.ASTUtils.isIdentifier(memberExpressionNode.object.callee) && memberExpressionNode.object.callee.name !== 'within' && isReportableRender(memberExpressionNode.object.callee) && !usesContainerOrBaseElement(memberExpressionNode.object)) {\n          reportInvalidUsage(identifierNode);\n          return;\n        }\n\n        if (utils_1.ASTUtils.isIdentifier(memberExpressionNode.object) && !isIdentifierAllowed(memberExpressionNode.object.name)) {\n          reportInvalidUsage(identifierNode);\n        }\n      }\n\n    };\n  }\n\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","RULE_NAME","utils_1","require","create_testing_library_rule_1","node_utils_1","ALLOWED_RENDER_PROPERTIES_FOR_DESTRUCTURING","usesContainerOrBaseElement","node","secondArgument","arguments","isObjectExpression","properties","some","property","isProperty","ASTUtils","isIdentifier","key","includes","name","default","createTestingLibraryRule","meta","type","docs","description","recommendedConfig","dom","angular","react","vue","marko","messages","preferScreenQueries","schema","defaultOptions","create","context","_","helpers","renderWrapperNames","detectRenderWrapper","innerFunction","getInnermostReturningFunction","push","getFunctionName","isReportableRender","isRenderUtil","reportInvalidUsage","report","messageId","data","saveSafeDestructuredQueries","isObjectPattern","id","isBuiltInQuery","safeDestructuredQueries","isIdentifierAllowed","withinDeclaredVariables","VariableDeclarator","isCallExpression","init","callee","isComingFromValidRender","isWithinFunction","usesRenderOptions","CallExpression","identifierNode","getDeepestIdentifierNode","isMemberExpression","parent","isSafeDestructuredQuery","queryName","memberExpressionNode","object"],"sources":["C:/Users/Rohith/mern/frontend/node_modules/eslint-plugin-testing-library/rules/prefer-screen-queries.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RULE_NAME = void 0;\nconst utils_1 = require(\"@typescript-eslint/utils\");\nconst create_testing_library_rule_1 = require(\"../create-testing-library-rule\");\nconst node_utils_1 = require(\"../node-utils\");\nexports.RULE_NAME = 'prefer-screen-queries';\nconst ALLOWED_RENDER_PROPERTIES_FOR_DESTRUCTURING = [\n    'container',\n    'baseElement',\n];\nfunction usesContainerOrBaseElement(node) {\n    const secondArgument = node.arguments[1];\n    return ((0, node_utils_1.isObjectExpression)(secondArgument) &&\n        secondArgument.properties.some((property) => (0, node_utils_1.isProperty)(property) &&\n            utils_1.ASTUtils.isIdentifier(property.key) &&\n            ALLOWED_RENDER_PROPERTIES_FOR_DESTRUCTURING.includes(property.key.name)));\n}\nexports.default = (0, create_testing_library_rule_1.createTestingLibraryRule)({\n    name: exports.RULE_NAME,\n    meta: {\n        type: 'suggestion',\n        docs: {\n            description: 'Suggest using `screen` while querying',\n            recommendedConfig: {\n                dom: 'error',\n                angular: 'error',\n                react: 'error',\n                vue: 'error',\n                marko: 'error',\n            },\n        },\n        messages: {\n            preferScreenQueries: 'Avoid destructuring queries from `render` result, use `screen.{{ name }}` instead',\n        },\n        schema: [],\n    },\n    defaultOptions: [],\n    create(context, _, helpers) {\n        const renderWrapperNames = [];\n        function detectRenderWrapper(node) {\n            const innerFunction = (0, node_utils_1.getInnermostReturningFunction)(context, node);\n            if (innerFunction) {\n                renderWrapperNames.push((0, node_utils_1.getFunctionName)(innerFunction));\n            }\n        }\n        function isReportableRender(node) {\n            return (helpers.isRenderUtil(node) || renderWrapperNames.includes(node.name));\n        }\n        function reportInvalidUsage(node) {\n            context.report({\n                node,\n                messageId: 'preferScreenQueries',\n                data: {\n                    name: node.name,\n                },\n            });\n        }\n        function saveSafeDestructuredQueries(node) {\n            if ((0, node_utils_1.isObjectPattern)(node.id)) {\n                for (const property of node.id.properties) {\n                    if ((0, node_utils_1.isProperty)(property) &&\n                        utils_1.ASTUtils.isIdentifier(property.key) &&\n                        helpers.isBuiltInQuery(property.key)) {\n                        safeDestructuredQueries.push(property.key.name);\n                    }\n                }\n            }\n        }\n        function isIdentifierAllowed(name) {\n            return ['screen', ...withinDeclaredVariables].includes(name);\n        }\n        const safeDestructuredQueries = [];\n        const withinDeclaredVariables = [];\n        return {\n            VariableDeclarator(node) {\n                if (!(0, node_utils_1.isCallExpression)(node.init) ||\n                    !utils_1.ASTUtils.isIdentifier(node.init.callee)) {\n                    return;\n                }\n                const isComingFromValidRender = isReportableRender(node.init.callee);\n                if (!isComingFromValidRender) {\n                    saveSafeDestructuredQueries(node);\n                }\n                const isWithinFunction = node.init.callee.name === 'within';\n                const usesRenderOptions = isComingFromValidRender && usesContainerOrBaseElement(node.init);\n                if (!isWithinFunction && !usesRenderOptions) {\n                    return;\n                }\n                if ((0, node_utils_1.isObjectPattern)(node.id)) {\n                    saveSafeDestructuredQueries(node);\n                }\n                else if (utils_1.ASTUtils.isIdentifier(node.id)) {\n                    withinDeclaredVariables.push(node.id.name);\n                }\n            },\n            CallExpression(node) {\n                const identifierNode = (0, node_utils_1.getDeepestIdentifierNode)(node);\n                if (!identifierNode) {\n                    return;\n                }\n                if (helpers.isRenderUtil(identifierNode)) {\n                    detectRenderWrapper(identifierNode);\n                }\n                if (!helpers.isBuiltInQuery(identifierNode)) {\n                    return;\n                }\n                if (!(0, node_utils_1.isMemberExpression)(identifierNode.parent)) {\n                    const isSafeDestructuredQuery = safeDestructuredQueries.some((queryName) => queryName === identifierNode.name);\n                    if (isSafeDestructuredQuery) {\n                        return;\n                    }\n                    reportInvalidUsage(identifierNode);\n                    return;\n                }\n                const memberExpressionNode = identifierNode.parent;\n                if ((0, node_utils_1.isCallExpression)(memberExpressionNode.object) &&\n                    utils_1.ASTUtils.isIdentifier(memberExpressionNode.object.callee) &&\n                    memberExpressionNode.object.callee.name !== 'within' &&\n                    isReportableRender(memberExpressionNode.object.callee) &&\n                    !usesContainerOrBaseElement(memberExpressionNode.object)) {\n                    reportInvalidUsage(identifierNode);\n                    return;\n                }\n                if (utils_1.ASTUtils.isIdentifier(memberExpressionNode.object) &&\n                    !isIdentifierAllowed(memberExpressionNode.object.name)) {\n                    reportInvalidUsage(identifierNode);\n                }\n            },\n        };\n    },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}